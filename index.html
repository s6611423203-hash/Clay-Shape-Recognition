<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clay Shape Recognition ‚Äî AI ‡∏ó‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</title>
  <meta name="description" content="‡∏™‡πÅ‡∏Å‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ AI (Teachable Machine) ‡∏ó‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏≠‡∏∞‡πÑ‡∏£" />
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
  /* =========================
     üé® Theme Variables
  ========================== */
  :root {
    --bg-gradient: linear-gradient(135deg, #a5f3fc, #fbcfe8, #fde68a);
    --fg:     #1f2937;  /* main text (dark gray) */
    --muted:  #6b7280;  /* secondary text */
    --card:   rgba(255,255,255,0.85); /* semi-transparent white */
    --accent: #ec4899;  /* pink */
    --ok:     #34d399;  /* mint green */
    --warn:   #f97316;  /* peach orange */
    --err:    #ef4444;  /* red */
    --ring:   #e5e7eb;  /* border color */
  }

  /* =========================
     üèóÔ∏è Global Reset & Body
  ========================== */
  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
                 "Apple Color Emoji", "Segoe UI Emoji";
    background: var(--bg-gradient);
    background-attachment: fixed; /* ‡πÑ‡∏•‡πà‡∏™‡∏µ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ */
    color: var(--fg);
  }

  /* =========================
     üè∑Ô∏è Header
  ========================== */
  header {
    max-width: 960px;
    margin: 24px auto 0;
    padding: 0 16px;
  }

  .title {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    background: linear-gradient(135deg, #f87171, #60a5fa, #facc15);
    display: grid;
    place-items: center;
    color: white;
    font-weight: 900;
    font-size: 18px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  h1 {
    font-size: clamp(20px, 4vw, 30px);
    margin: 0;
  }

  p.sub {
    color: var(--muted);
    margin: 6px 0 0;
  }

  /* =========================
     üì¶ Layout / Card
  ========================== */
  main {
    max-width: 960px;
    margin: 20px auto 56px;
    padding: 0 16px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--ring);
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,.1);
    backdrop-filter: blur(10px); /* glass effect */
  }

  .row {
    display: grid;
    gap: 16px;
  }

  @media (min-width: 900px) {
    .row { grid-template-columns: 1.2fr .8fr; }
  }

  /* =========================
     üîò Buttons / Controls
  ========================== */
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 8px 0 12px;
  }

  button,
  input[type=file] { font: inherit; }

  .btn {
    appearance: none;
    border: none;
    background: #fff;
    color: var(--fg);
    padding: 10px 16px;
    border-radius: 14px;
    cursor: pointer;
    transition: .2s;
    box-shadow: 0 3px 8px rgba(0,0,0,.08);
  }

  .btn:hover { transform: translateY(-2px) scale(1.02); }

  .btn.primary { background: var(--accent); color: #fff; }
  .btn.good    { background: var(--ok);     color: #fff; }
  .btn.warn    { background: var(--warn);   color: #fff; }

  .hidden { display: none!important; }

  /* =========================
     üñºÔ∏è Preview Area
  ========================== */
  .previewBox {
    background: rgba(255,255,255,0.9);
    border: 2px dashed var(--ring);
    border-radius: 16px;
    min-height: 320px;
    display: grid;
    place-items: center;
    overflow: hidden;
  }

  video, img {
    max-width: 100%;
    height: auto;
    display: block;
  }

  /* =========================
     üìù Result & Status
  ========================== */
  .status { font-size: 14px; color: var(--muted); }

  .result {
    background: rgba(255,255,255,0.9);
    border: 1px solid var(--ring);
    border-radius: 14px;
    padding: 14px;
    box-shadow: 0 3px 10px rgba(0,0,0,.05);
  }

  .pred {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin: 8px 0;
  }

  .bar {
    height: 10px;
    background: #f3f4f6;
    border-radius: 999px;
    overflow: hidden;
    flex: 1;
    margin: 0 10px;
  }

  .bar > span {
    display: block;
    height: 100%;
    background: var(--accent);
    width: 0%;
  }

  /* =========================
     üìë Footer & Notes
  ========================== */
  .foot {
    max-width: 960px;
    margin: 10px auto 32px;
    padding: 0 16px;
    color: var(--muted);
    font-size: 13px;
    text-align: center;
  }

  .note {
    padding: 10px 12px;
    border-left: 4px solid var(--accent);
    background: #fdf2f8;
    border-radius: 8px;
  }

  .danger { border-left-color: var(--err);  background: #fef2f2; }
  .ok     { border-left-color: var(--ok);   background: #ecfdf5; }

  /* =========================
     üì± Utility
  ========================== */
  .grid-2 { display: grid; gap: 12px; }
  @media (min-width: 700px) {
    .grid-2 { grid-template-columns: 1fr 1fr; }
  }

  .material-icons {
    font-size: 18px;
    vertical-align: -2px;
    margin-right: 6px;
  }
</style>

</head>
<body>
  <header>
    <div class="title">
      <div class="logo">CV</div>
      <div>
        <h1>Clay Shape Recognition ‚Äî AI ‡∏ó‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h1>
        <p class="sub">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• <b>Teachable Machine</b> ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏≠‡∏∞‡πÑ‡∏£</p>
      </div>
    </div>
  </header>

  <main>
    <div class="card row">
      <section>
        <div class="controls">
          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î: ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ/‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ -->
          <button id="btnUpload" class="btn" type="button">
            <span class="material-icons">file_upload</span>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
          </button>
          <!-- ‡∏ï‡∏±‡∏î capture ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ -->
          <input id="fileInput" type="file" accept="image/*" class="hidden" />

          <button id="btnStartCam" class="btn primary" type="button">
            <span class="material-icons">photo_camera</span>‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
          <button id="btnSnap" class="btn good hidden" type="button">
            <span class="material-icons">camera_alt</span>‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢
          </button>
          <button id="btnStopCam" class="btn warn hidden" type="button">
            <span class="material-icons">stop</span>‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
        </div>

        <div id="stage" class="previewBox">
          <video id="video" class="hidden" playsinline autoplay muted></video>
          <img id="preview" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û" class="hidden" />
          <canvas id="canvas" class="hidden"></canvas>
          <div id="placeholder" class="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
        </div>
        <div style="margin-top:8px" class="status" id="camStatus"></div>
      </section>

      <aside>
        <div class="grid-2">
          <div class="note" id="modelStatus">
            ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏°‡πÄ‡∏î‡∏•: <b>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</b> (‡πÇ‡∏õ‡∏£‡∏î‡∏ß‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <code>/model</code>)
          </div>
          <!-- ‡∏•‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á HTTPS note ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
        </div>
        <div style="height:12px"></div>
        <div class="result">
          <div class="status">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</div>
          <h3 id="top1" style="margin:8px 0 4px">‚Äî</h3>
          <div id="predList"></div>
        </div>

      </aside>
    </div>
  </main>

  <footer class="foot">
    <div class="note">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ‡∏à‡∏±‡∏î‡πÑ‡∏ü‡πÉ‡∏´‡πâ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡∏â‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡πÅ‡∏•‡∏∞‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏∏‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏•‡∏≤‡∏™</div>
  </footer>

  <script>
    const MODEL_URL = "./model/";
    let model, maxPredictions;

    const modelStatus = document.getElementById('modelStatus');

    async function loadModel(){
      try{
        model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
        maxPredictions = model.getTotalClasses();
        modelStatus.innerHTML = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏°‡πÄ‡∏î‡∏•: <b style="color:var(--ok)">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</b> ‚Äî ‡∏û‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ' + maxPredictions;
      }catch(err){
        console.error(err);
        modelStatus.classList.add('danger');
        modelStatus.innerHTML = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏°‡πÄ‡∏î‡∏•: <b style="color:var(--err)">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</b> ‚Äî ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <code>/model</code> ‡∏°‡∏µ <code>model.json</code>, <code>metadata.json</code>, <code>weights.bin</code>';
      }
    }
    loadModel();

    const fileInput   = document.getElementById('fileInput');
    const btnUpload   = document.getElementById('btnUpload');
    const btnStartCam = document.getElementById('btnStartCam');
    const btnStopCam  = document.getElementById('btnStopCam');
    const btnSnap     = document.getElementById('btnSnap');

    const video = document.getElementById('video');
    const preview = document.getElementById('preview');
    const placeholder = document.getElementById('placeholder');
    const canvas = document.getElementById('canvas');
    const camStatus = document.getElementById('camStatus');

    const top1 = document.getElementById('top1');
    const predList = document.getElementById('predList');

    // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á
    btnUpload.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', async (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      stopCamera();
      const url = URL.createObjectURL(file);
      preview.src = url;
      await showImage();
      await predict(preview);
    });

    // ‡∏Å‡∏•‡πâ‡∏≠‡∏á
    let stream;
    async function startCamera(){
      try{
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { ideal: "environment" }, width: { ideal: 1280 }, height: { ideal: 720 } },
          audio: false
        });
        video.srcObject = stream;
        video.classList.remove('hidden');
        preview.classList.add('hidden');
        placeholder.classList.add('hidden');
        btnSnap.classList.remove('hidden');
        btnStopCam.classList.remove('hidden');
        camStatus.textContent = '‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÅ‡∏ï‡∏∞ ‚Äú‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‚Äù)';
      }catch(err){
        console.error(err);
        camStatus.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + err.message;
      }
    }

    function stopCamera(){
      if(stream){
        stream.getTracks().forEach(t=> t.stop());
        stream = null;
      }
      video.classList.add('hidden');
      btnSnap.classList.add('hidden');
      btnStopCam.classList.add('hidden');
      camStatus.textContent = '';
    }

    btnStartCam.addEventListener('click', startCamera);
    btnStopCam.addEventListener('click', stopCamera);

    btnSnap.addEventListener('click', async ()=>{
      if(!stream){ camStatus.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á'; return; }
      const w = video.videoWidth || 640;
      const h = video.videoHeight || 480;
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, w, h);
      preview.src = canvas.toDataURL('image/jpeg');
      await showImage();
      await predict(preview);
    });

    async function showImage(){
      video.classList.add('hidden');
      preview.classList.remove('hidden');
      placeholder.classList.add('hidden');
      await new Promise(r => (preview.onload = r));
    }

    async function predict(imgEl){
      if(!model){ top1.textContent = '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'; return; }
      const predictions = await model.predict(imgEl, false);
      predictions.sort((a,b)=> b.probability - a.probability);

      const best = predictions[0];
      const pct = (best.probability*100).toFixed(1);
      top1.textContent = `‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏õ‡∏±‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠: ${best.className} (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ${pct}%)`;

      predList.innerHTML = '';
      for(const p of predictions){
        const percent = (p.probability*100).toFixed(1);
        const row = document.createElement('div');
        row.className = 'pred';
        const name = document.createElement('div');
        name.textContent = p.className;
        const bar = document.createElement('div');
        bar.className = 'bar';
        const fill = document.createElement('span');
        fill.style.width = percent + '%';
        bar.appendChild(fill);
        const val = document.createElement('div');
        val.textContent = percent + '%';
        row.appendChild(name); row.appendChild(bar); row.appendChild(val);
        predList.appendChild(row);
      }
    }
  </script>
</body>
</html>
